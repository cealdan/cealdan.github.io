<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>midigen.ipynb - Jupyter Notebook</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #fff; }
    .header { background: #f5f5f5; border-bottom: 1px solid #ccc; padding: 8px 16px; display: flex; align-items: center; gap: 16px; }
    .logo { width: 24px; height: 24px; }
    .header-title { font-weight: 600; color: #444; }
    .header-file { font-size: 14px; color: #666; }
    .kernel-badge { margin-left: auto; padding: 4px 8px; background: #d4edda; color: #155724; border-radius: 4px; font-size: 12px; }
    .menubar { background: #fafafa; border-bottom: 1px solid #ccc; padding: 4px 16px; display: flex; gap: 4px; }
    .menubar button { padding: 4px 12px; background: none; border: none; font-size: 14px; color: #444; cursor: pointer; border-radius: 4px; }
    .menubar button:hover { background: #e0e0e0; }
    .toolbar { background: #f5f5f5; border-bottom: 1px solid #ccc; padding: 4px 16px; display: flex; gap: 4px; align-items: center; }
    .toolbar button { padding: 4px 8px; background: none; border: none; cursor: pointer; border-radius: 4px; }
    .toolbar button:hover { background: #e0e0e0; }
    .toolbar select { border: 1px solid #ccc; border-radius: 4px; padding: 4px 8px; font-size: 14px; }
    .separator { margin: 0 8px; color: #ccc; }
    .container { max-width: 1100px; margin: 0 auto; padding: 24px; }
    .cell { margin-bottom: 16px; }
    .code-cell { border: 1px solid #ccc; border-radius: 4px; overflow: hidden; }
    .cell-input { display: flex; }
    .cell-prompt { background: #f7f7f7; padding: 8px 12px; color: #999; font-family: monospace; font-size: 14px; border-right: 1px solid #ccc; min-width: 70px; text-align: right; user-select: none; }
    .cell-prompt.out { background: #fff; color: #d9534f; }
    .cell-code { flex: 1; background: #f7f7f7; overflow-x: auto; }
    .cell-code pre { padding: 8px; font-size: 14px; font-family: 'SF Mono', Monaco, 'Courier New', monospace; line-height: 1.5; margin: 0; }
    .cell-output { border-top: 1px solid #ccc; display: flex; }
    .cell-output-content { flex: 1; padding: 8px; overflow-x: auto; background: #fff; }
    .cell-output-content pre { font-family: monospace; font-size: 14px; white-space: pre-wrap; margin: 0; }
    .cell-output-content img { max-width: 100%; }
    .error { color: #d9534f; }
    .markdown-cell { padding: 8px 16px; }
    .markdown-cell h1 { font-size: 2em; font-weight: bold; margin: 16px 0 12px; }
    .markdown-cell h2 { font-size: 1.5em; font-weight: 600; margin: 14px 0 10px; }
    .markdown-cell h3 { font-size: 1.2em; font-weight: 600; margin: 12px 0 8px; }
    .markdown-cell p { margin: 8px 0; line-height: 1.6; }
    .markdown-cell code { background: #f0f0f0; padding: 2px 6px; border-radius: 3px; font-family: monospace; font-size: 0.9em; }
    .markdown-cell pre { background: #f7f7f7; padding: 12px; border-radius: 4px; overflow-x: auto; }
    .markdown-cell ul, .markdown-cell ol { margin: 8px 0; padding-left: 24px; }
    .markdown-cell li { margin: 4px 0; }
    .raw-cell { padding: 8px 16px; background: #f5f5f5; border-radius: 4px; margin: 8px 16px; }
    .raw-cell pre { font-family: monospace; font-size: 14px; white-space: pre-wrap; margin: 0; }
    table { border-collapse: collapse; margin: 8px 0; font-size: 14px; }
    th, td { border: 1px solid #ddd; padding: 6px 12px; text-align: left; }
    th { background: #f5f5f5; font-weight: 600; }
    tr:nth-child(even) { background: #fafafa; }
    .loading { display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 100vh; }
    .spinner { width: 48px; height: 48px; border: 3px solid #f3f3f3; border-top: 3px solid #F37626; border-radius: 50%; animation: spin 1s linear infinite; }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    .error-box { background: #f8d7da; border: 1px solid #f5c6cb; color: #721c24; padding: 16px 24px; border-radius: 4px; max-width: 500px; }
    .kw { color: #8959a8; font-weight: 600; }
    .str { color: #718c00; }
    .num { color: #1d75b3; }
    .cmt { color: #8e908c; font-style: italic; }
  </style>
</head>
<body>
  <div id="app">
    <div class="loading">
      <div class="spinner"></div>
      <p style="margin-top: 16px; color: #666;">Chargement du notebook...</p>
    </div>
  </div>

  <script>
    const NOTEBOOK_FILE = './midigen.ipynb';

    const KEYWORDS = ['import', 'from', 'def', 'class', 'return', 'if', 'elif', 'else', 'for', 'while', 'in', 'and', 'or', 'not', 'True', 'False', 'None', 'print', 'with', 'as', 'try', 'except', 'finally', 'raise', 'lambda', 'yield', 'break', 'continue', 'pass', 'assert', 'del', 'global', 'is', 'async', 'await'];

    function highlightCode(code) {
      let result = '';
      let i = 0;
      while (i < code.length) {
        if (code[i] === '#') {
          result += `<span class="cmt">${escapeHtml(code.slice(i))}</span>`;
          break;
        }
        if (code[i] === '"' || code[i] === "'") {
          const quote = code[i];
          const triple = code.slice(i, i + 3) === quote.repeat(3);
          const end = triple ? quote.repeat(3) : quote;
          const start = triple ? i + 3 : i + 1;
          let j = start;
          while (j < code.length) {
            if (code.slice(j, j + end.length) === end) { j += end.length; break; }
            j++;
          }
          result += `<span class="str">${escapeHtml(code.slice(i, j))}</span>`;
          i = j;
          continue;
        }
        const numMatch = code.slice(i).match(/^\d+\.?\d*/);
        if (numMatch && (i === 0 || !/\w/.test(code[i - 1]))) {
          result += `<span class="num">${numMatch[0]}</span>`;
          i += numMatch[0].length;
          continue;
        }
        let kwFound = false;
        for (const kw of KEYWORDS) {
          if (code.slice(i, i + kw.length) === kw && (i === 0 || !/\w/.test(code[i - 1])) && (i + kw.length >= code.length || !/\w/.test(code[i + kw.length]))) {
            result += `<span class="kw">${kw}</span>`;
            i += kw.length;
            kwFound = true;
            break;
          }
        }
        if (kwFound) continue;
        result += escapeHtml(code[i]);
        i++;
      }
      return result;
    }

    function escapeHtml(text) {
      return text.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/"/g, '&quot;');
    }

    function renderMarkdown(md) {
      return md
        .replace(/^#### (.*$)/gim, '<h4>$1</h4>')
        .replace(/^### (.*$)/gim, '<h3>$1</h3>')
        .replace(/^## (.*$)/gim, '<h2>$1</h2>')
        .replace(/^# (.*$)/gim, '<h1>$1</h1>')
        .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
        .replace(/\*(.*?)\*/g, '<em>$1</em>')
        .replace(/`([^`]+)`/g, '<code>$1</code>')
        .replace(/^\s*[-*]\s+(.*)$/gim, '<li>$1</li>')
        .replace(/(<li>.*<\/li>)/s, '<ul>$1</ul>')
        .replace(/\n\n/g, '</p><p>')
        .replace(/\n/g, '<br>');
    }

    function getSource(cell) {
      return Array.isArray(cell.source) ? cell.source.join('') : cell.source;
    }

    function renderOutput(output) {
      if (output.output_type === 'stream') {
        const text = Array.isArray(output.text) ? output.text.join('') : output.text;
        return `<pre>${escapeHtml(text)}</pre>`;
      }
      if (output.output_type === 'execute_result' || output.output_type === 'display_data') {
        const data = output.data;
        if (data['text/html']) {
          return Array.isArray(data['text/html']) ? data['text/html'].join('') : data['text/html'];
        }
        if (data['image/png']) {
          return `<img src="data:image/png;base64,${data['image/png']}" alt="output">`;
        }
        if (data['image/jpeg']) {
          return `<img src="data:image/jpeg;base64,${data['image/jpeg']}" alt="output">`;
        }
        if (data['text/plain']) {
          const text = Array.isArray(data['text/plain']) ? data['text/plain'].join('') : data['text/plain'];
          return `<pre>${escapeHtml(text)}</pre>`;
        }
      }
      if (output.output_type === 'error') {
        const tb = output.traceback ? output.traceback.join('\n') : `${output.ename}: ${output.evalue}`;
        const clean = tb.replace(/\x1b\[[0-9;]*m/g, '');
        return `<pre class="error">${escapeHtml(clean)}</pre>`;
      }
      return '';
    }

    function renderCodeCell(cell) {
      const source = getSource(cell);
      const lines = source.split('\n').map(line => highlightCode(line)).join('\n');
      const execCount = cell.execution_count || ' ';
      let outputHtml = '';
      if (cell.outputs && cell.outputs.length > 0) {
        const outputs = cell.outputs.map(renderOutput).join('');
        outputHtml = `
          <div class="cell-output">
            <div class="cell-prompt out">[${execCount}]:</div>
            <div class="cell-output-content">${outputs}</div>
          </div>`;
      }
      return `
        <div class="cell code-cell">
          <div class="cell-input">
            <div class="cell-prompt">[${execCount}]:</div>
            <div class="cell-code"><pre>${lines}</pre></div>
          </div>
          ${outputHtml}
        </div>`;
    }

    function renderMarkdownCell(cell) {
      const source = getSource(cell);
      return `<div class="cell markdown-cell"><p>${renderMarkdown(source)}</p></div>`;
    }

    function renderRawCell(cell) {
      const source = getSource(cell);
      return `<div class="cell raw-cell"><pre>${escapeHtml(source)}</pre></div>`;
    }

    function renderNotebook(notebook) {
      const kernel = notebook.metadata?.kernelspec?.display_name || 'Python 3';
      const cells = notebook.cells.map(cell => {
        if (cell.cell_type === 'code') return renderCodeCell(cell);
        if (cell.cell_type === 'markdown') return renderMarkdownCell(cell);
        if (cell.cell_type === 'raw') return renderRawCell(cell);
        return '';
      }).join('');

      return `
        <div class="header">
          <svg class="logo" viewBox="0 0 44 51">
            <path fill="#F37626" d="M22 0C9.8 0 0 9.8 0 22c0 9.9 6.5 18.3 15.5 21.1V51l6.5-6.5 6.5 6.5v-7.9C37.5 40.3 44 31.9 44 22 44 9.8 34.2 0 22 0z"/>
            <path fill="#fff" d="M22 10c-6.6 0-12 5.4-12 12s5.4 12 12 12 12-5.4 12-12-5.4-12-12-12z"/>
          </svg>
          <span class="header-title">Jupyter Notebook</span>
          <span class="header-file">midigen.ipynb</span>
          <span class="kernel-badge">${escapeHtml(kernel)}</span>
        </div>
        <div class="menubar">
          <button>File</button><button>Edit</button><button>View</button><button>Insert</button><button>Cell</button><button>Kernel</button><button>Help</button>
        </div>
        <div class="toolbar">
          <button>üíæ</button><button>‚ûï</button><button>‚úÇÔ∏è</button><button>üìã</button><button>‚ñ∂Ô∏è</button><button>‚èπÔ∏è</button><button>üîÑ</button>
          <span class="separator">|</span>
          <select><option>Code</option><option>Markdown</option><option>Raw</option></select>
        </div>
        <div class="container">${cells}</div>`;
    }

    function showError(message) {
      document.getElementById('app').innerHTML = `
        <div class="loading">
          <div class="error-box">
            <h3 style="margin-bottom: 8px;">Erreur</h3>
            <p>${escapeHtml(message)}</p>
          </div>
        </div>`;
    }

    fetch(NOTEBOOK_FILE)
      .then(res => {
        if (!res.ok) throw new Error(`Impossible de charger ${NOTEBOOK_FILE} (${res.status})`);
        return res.json();
      })
      .then(notebook => {
        document.getElementById('app').innerHTML = renderNotebook(notebook);
      })
      .catch(err => showError(err.message));
  </script>
</body>
</html>