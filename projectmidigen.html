<!DOCTYPE html>
<html lang="fr">
<head>
<link rel="icon" type="image/svg+xml" href="images/aletheialogocircle.png">
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MidiGen - G√©n√©rateur de m√©lodies</title>
<link rel="stylesheet" href="shared.css" />
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }

body { 
    background: #111; 
    color: #fff; 
    overflow-x: hidden;
    font-family: Arial, sans-serif;
    line-height: 1.6;
}

.project-header {
    padding: 2rem 1rem;
    text-align: center;
}

.project-header h1 {
    margin-bottom: 1rem;
    font-size: 2.2rem;
}

.project-date {
    font-size: 1rem;
    opacity: 0.8;
    margin-bottom: 1.5rem;
    font-style: italic;
    color: #4da6ff;
}

.project-header a {
    color: #4da6ff;
    text-decoration: none;
    display: inline-block;
    margin-bottom: 1.5rem;
    padding: 0.5rem 1rem;
    border: 2px solid #4da6ff;
    border-radius: 6px;
}

.project-header a:hover {
    background: #4da6ff;
    color: #111;
}

section {
    padding: 2rem 1rem;
    max-width: 1000px;
    margin: 0 auto;
}

section a {
    color: #4da6ff;
    text-decoration: underline;
}

.text-container {
    width: 100%;
    max-width: 95%;
    margin: 0 auto;
    padding-bottom: 2rem;
}

.text-container p {
    font-size: 1rem;
    line-height: 1.8;
    margin-bottom: 1rem;
}

/* Audio Section - Style Glass + Card dynamique */
.audio-section {
    background: rgba(28, 28, 30, 0.4);
    backdrop-filter: blur(30px) saturate(180%);
    -webkit-backdrop-filter: blur(30px) saturate(180%);
    border-radius: 30px;
    padding: 1.5rem;
    margin: 2rem auto;
    max-width: 95%;
    border: 1px solid rgba(255, 255, 255, 0.1);
    box-shadow: 0 10px 40px rgba(0,0,0,0.3);
}

.audio-section:hover {
    transform: translateY(-5px) scale(1.01);
    box-shadow: 0 20px 50px rgba(0,0,0,0.4);
}

.audio-section h3 {
    color: #4da6ff;
    margin-bottom: 1rem;
    font-size: 1.2rem;
}

.audio-item {
    margin-bottom: 1.5rem;
}
.audio-item:last-child { margin-bottom: 0; }
.audio-item p { margin-bottom: 0.5rem; font-weight: 500; }
.audio-item audio { width: 100%; border-radius: 8px; }

/* Notebook Container - Style Glass + Card dynamique */
.notebook-container {
    background: #fff;
    border-radius: 30px;
    margin: 2rem auto;
    max-width: 95%;
    box-shadow: 0 10px 40px rgba(0,0,0,0.3);
    overflow: hidden;
    max-height: 600px;
    display: flex;
    flex-direction: column;
    border: 1px solid rgba(255, 255, 255, 0.1);
    transition: all 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
}

.notebook-container.resetting {
    transition: none !important;
    transform: none !important;
}

.notebook-container:not(.fullscreen):hover {
    transform: translateY(-5px) scale(1.01);
    box-shadow: 0 20px 50px rgba(0,0,0,0.4);
}

.notebook-container.fullscreen {
  position: fixed;
  top: 0; left: 0; right: 0; bottom: 0;
  max-width: 100%;
  max-height: 100%;
  margin: 0;
  border-radius: 0;
  z-index: 9999;
  
  /* --- AJOUTS POUR CORRIGER LE BUG --- */
  /* On force l'annulation de la transformation sans d√©lai */
  transform: none !important; 
  /* On d√©sactive l'animation pour √©viter que le notebook ne "glisse" en prenant sa place */
  transition: none !important; 
  /* On retire l'ombre qui n'a plus de sens en plein √©cran */
  box-shadow: none !important;
}

.notebook-header {
    background: #f5f5f5;
    border-bottom: 1px solid #ccc;
    padding: 8px 16px;
    display: flex;
    align-items: center;
    gap: 16px;
    flex-shrink: 0;
}

.notebook-logo { width: 24px; height: 24px; }
.notebook-title { font-weight: 600; color: #444; font-size: 14px; }
.notebook-file { font-size: 14px; color: #666; }
.kernel-badge { margin-left: auto; padding: 4px 8px; background: #d4edda; color: #155724; border-radius: 4px; font-size: 12px; }
.readonly-badge { padding: 4px 8px; background: #fff3cd; color: #856404; border-radius: 4px; font-size: 12px; }
.notebook-content { overflow-y: auto; flex: 1; padding: 16px; background: #fff; }

.cell { margin-bottom: 16px; }
.code-cell { border: 1px solid #ccc; border-radius: 4px; overflow: hidden; }
.cell-input { display: flex; }
.cell-prompt { background: #f7f7f7; padding: 8px 12px; color: #999; font-family: monospace; font-size: 14px; border-right: 1px solid #ccc; min-width: 70px; text-align: right; user-select: none; }
.cell-prompt.out { background: #fff; color: #d9534f; }
.cell-code { flex: 1; background: #f7f7f7; overflow-x: auto; }
.cell-code pre { padding: 8px; font-size: 13px; font-family: 'SF Mono', Monaco, 'Courier New', monospace; line-height: 1.5; margin: 0; color: #333; }
.cell-output { border-top: 1px solid #ccc; display: flex; }
.cell-output-content { flex: 1; padding: 8px; overflow-x: auto; background: #fff; }
.cell-output-content pre { font-family: monospace; font-size: 13px; white-space: pre-wrap; margin: 0; color: #333; }
.markdown-cell { padding: 8px 16px; color: #333; }
.markdown-cell h1 { font-size: 1.8em; font-weight: bold; margin: 16px 0 12px; color: #333; }
.markdown-cell h2 { font-size: 1.4em; font-weight: 600; margin: 14px 0 10px; color: #333; }
.markdown-cell p { margin: 8px 0; line-height: 1.6; color: #333; }
.markdown-cell code { background: #f0f0f0; padding: 2px 6px; border-radius: 3px; font-family: monospace; font-size: 0.9em; }

.expand-btn {
  background: #4da6ff;
  color: #fff;
  border: none;
  padding: 6px 12px;
  border-radius: 4px;
  font-size: 12px;
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 6px;
}
.expand-btn:hover { background: #3a8fd9; }
.expand-btn svg { width: 14px; height: 14px; fill: currentColor; }

/* Syntax highlighting */
.kw { color: #8959a8; font-weight: 600; }
.str { color: #718c00; }
.num { color: #1d75b3; }
.cmt { color: #8e908c; font-style: italic; }
.func { color: #4271ae; }

footer { text-align: center; padding: 2rem; color: #888; font-size: 0.9rem; margin-top: 3rem; }

/* Light theme */
body.light { background: #f5f5f5; color: #000; }

/* Audio Section Light Glass */
body.light .audio-section {
    background: rgba(255, 255, 255, 0.55);
    backdrop-filter: blur(30px) saturate(150%);
    -webkit-backdrop-filter: blur(30px) saturate(150%);
    border: 1px solid rgba(255, 255, 255, 0.6);
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
}

body.light .notebook-container {
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
    border: 1px solid rgba(0, 0, 0, 0.05);
}

body.light .project-header a { border-color: #0077cc; color: #0077cc; }
body.light .project-header a:hover { background: #0077cc; color: #fff; }

/* Mobile */
@media (max-width: 768px) {
    .project-header h1 { font-size: 1.8rem; }
    .project-header { padding: 1.5rem 1rem; margin-top: 2.5rem; }
    section { padding: 1.5rem 0.75rem; }
    .text-container p { font-size: 0.95rem; }
    .notebook-container { max-height: 500px; }
    .cell-output-content pre, .cell-code pre, .cell-prompt { white-space: pre-wrap; word-wrap: break-word; overflow-x: hidden; }
    .cell-code pre { font-size: 12px; }
    .cell-prompt { min-width: 50px; font-size: 11px; padding: 6px 8px; }
    .expand-btn { padding: 6px 10px; font-size: 11px; }
    .notebook-container.fullscreen .cell-code pre { font-size: 12px; }
    .notebook-container.fullscreen .cell-prompt { min-width: 50px; font-size: 12px; }
}

@media (max-width: 480px) {
    .project-header h1 { font-size: 1.5rem; }
    .notebook-container { max-height: 400px; }
    .notebook-container:not(.fullscreen) { max-height: 400px; }
    .notebook-header { flex-wrap: wrap; gap: 8px; }
    .kernel-badge, .readonly-badge { font-size: 10px; }
    .cell-code pre { font-size: 11px; }
    .cell-prompt { min-width: 50px; font-size: 10px; padding: 6px 8px; }
}

.notebook-container.fullscreen .notebook-header {
  position: sticky; top: 0; z-index: 10; background: #f5f5f5; border-bottom: 2px solid #4da6ff;
}
.notebook-container.fullscreen .notebook-content { padding: 12px; }
</style>
</head>
<body>
<div data-include="components/topbar.html"></div>
<div data-include="components/sidebar.html"></div>
<canvas id="background-canvas"></canvas>

<header class="project-header">
    <h1>MidiGen</h1>
    <p class="project-date" data-lang="midigen-date">Mars 2024 (termin√©)</p>
</header>

<section>
    <div class="text-container">
        <p data-lang="midigen-intro">
            MidiGen est un g√©n√©rateur de m√©lodies MIDI utilisant des cha√Ænes de Markov...
        </p>
        <p data-lang="midigen-description">
            Le notebook Python ci-dessous montre comment analyser des fichiers MIDI...
        </p>
    </div>

    <div class="audio-section">
        <h3 data-lang="midigen-results">üéµ R√©sultats g√©n√©r√©s</h3>
        <div class="audio-item">
            <p>Melody Generated (Cheerful)</p>
            <audio controls>
                <source src="audio/Melody_Generated(cheerful).wav" type="audio/wav">
                <span data-lang="audio-error">Votre navigateur ne supporte pas la lecture audio.</span>
            </audio>
        </div>
        <div class="audio-item">
            <p>Melody Generated (Disco Fast)</p>
            <audio controls>
                <source src="audio/Melody_Generated(disco fast).wav" type="audio/wav">
                <span data-lang="audio-error">Votre navigateur ne supporte pas la lecture audio.</span>
            </audio>
        </div>
    </div>

    <div class="notebook-container" id= "notebook">
        <div class="notebook-header">
            <svg class="notebook-logo" viewBox="0 0 44 51">
                <path fill="#F37626" d="M22 0C9.8 0 0 9.8 0 22c0 9.9 6.5 18.3 15.5 21.1V51l6.5-6.5 6.5 6.5v-7.9C37.5 40.3 44 31.9 44 22 44 9.8 34.2 0 22 0z"/>
                <path fill="#fff" d="M22 10c-6.6 0-12 5.4-12 12s5.4 12 12 12 12-5.4 12-12-5.4-12-12-12z"/>
            </svg>
            <span class="notebook-title">Jupyter Notebook</span>
            <span class="notebook-file">midigen.ipynb</span>
            <span class="readonly-badge" data-lang="read-only">Lecture seule</span>
            <span class="kernel-badge">Python 3</span>
            <button class="expand-btn" id="expand-btn">
              <svg id="expand-icon" viewBox="0 0 24 24"><path d="M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z"/></svg>
              <span id="expand-text" data-lang="agrandir">Agrandir</span>
            </button>
        </div>
        <div class="notebook-content" id="notebook-content">
            <div style="text-align: center; padding: 2rem; color: #666;">
                Chargement du notebook...
            </div>
        </div>
        <a href="https://www.kaggle.com/code/cealdan/midigen" target="_blank" class="kaggle-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 128 128"><path d="M100.402 127.243c-.126.501-.627.752-1.502.752H82.168c-1.007 0-1.876-.438-2.632-1.317L51.91 91.531l-7.706 7.33v27.258c0 1.255-.628 1.881-1.88 1.881h-12.97c-1.254 0-1.88-.626-1.88-1.88V1.876c0-1.25.625-1.877 1.88-1.877h12.97c1.253 0 1.882.628 1.882 1.876v76.501l33.08-33.457c.878-.875 1.755-1.315 2.631-1.315h17.295c.75 0 1.25.315 1.504.937.252.753.19 1.316-.19 1.693L63.561 80.062l36.465 45.3c.499.502.625 1.128.38 1.881"/></svg>
            <span data-lang="view-on-kaggle">Voir sur Kaggle</span>
        </a>
    </div>
</section>  

<footer>
    Copyright ¬© 2025 Dimitri Bo√Ødo
</footer>

<script src="shared.js"></script>
<script>
// (Le script reste identique √† la version pr√©c√©dente)
const NOTEBOOK_FILE = './midigen.ipynb';
const KEYWORDS = ['import', 'from', 'def', 'class', 'return', 'if', 'elif', 'else', 'for', 'while', 'in', 'and', 'or', 'not', 'True', 'False', 'None', 'print', 'with', 'as', 'try', 'except', 'finally', 'raise', 'lambda', 'yield', 'break', 'continue', 'pass', 'assert', 'del', 'global', 'is', 'async', 'await'];
function escapeHtml(text) { return text.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/"/g, '&quot;'); }
function highlightCode(code) {
    let result = ''; let i = 0;
    while (i < code.length) {
        if (code[i] === '#') { result += `<span class="cmt">${escapeHtml(code.slice(i))}</span>`; break; }
        if (code[i] === '"' || code[i] === "'") {
            const quote = code[i]; const triple = code.slice(i, i + 3) === quote.repeat(3);
            const end = triple ? quote.repeat(3) : quote; const start = triple ? i + 3 : i + 1;
            let j = start; while (j < code.length) { if (code.slice(j, j + end.length) === end) { j += end.length; break; } j++; }
            result += `<span class="str">${escapeHtml(code.slice(i, j))}</span>`; i = j; continue;
        }
        const numMatch = code.slice(i).match(/^\d+\.?\d*/);
        if (numMatch && (i === 0 || !/\w/.test(code[i - 1]))) { result += `<span class="num">${numMatch[0]}</span>`; i += numMatch[0].length; continue; }
        let kwFound = false;
        for (const kw of KEYWORDS) {
            if (code.slice(i, i + kw.length) === kw && (i === 0 || !/\w/.test(code[i - 1])) && (i + kw.length >= code.length || !/\w/.test(code[i + kw.length]))) {
                result += `<span class="kw">${kw}</span>`; i += kw.length; kwFound = true; break;
            }
        }
        if (kwFound) continue; result += escapeHtml(code[i]); i++;
    }
    return result;
}
function renderMarkdown(md) {
    return md.replace(/^### (.*$)/gim, '<h3>$1</h3>').replace(/^## (.*$)/gim, '<h2>$1</h2>').replace(/^# (.*$)/gim, '<h1>$1</h1>')
        .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>').replace(/\*(.*?)\*/g, '<em>$1</em>').replace(/`([^`]+)`/g, '<code>$1</code>')
        .replace(/\n\n/g, '</p><p>').replace(/\n/g, '<br>');
}
function getSource(cell) { return Array.isArray(cell.source) ? cell.source.join('') : cell.source; }
function renderOutput(output) {
    if (output.output_type === 'stream') { return `<pre>${escapeHtml(Array.isArray(output.text) ? output.text.join('') : output.text)}</pre>`; }
    if (output.output_type === 'execute_result' || output.output_type === 'display_data') {
        const data = output.data;
        if (data['text/html']) return Array.isArray(data['text/html']) ? data['text/html'].join('') : data['text/html'];
        if (data['image/png']) return `<img src="data:image/png;base64,${data['image/png']}" alt="output" style="max-width:100%;">`;
        if (data['text/plain']) return `<pre>${escapeHtml(Array.isArray(data['text/plain']) ? data['text/plain'].join('') : data['text/plain'])}</pre>`;
    }
    if (output.output_type === 'error') {
        const tb = output.traceback ? output.traceback.join('\n') : `${output.ename}: ${output.evalue}`;
        const clean = tb.replace(/\x1b\[[0-9;]*m/g, ''); return `<pre style="color:#d9534f;">${escapeHtml(clean)}</pre>`;
    }
    return '';
}
function renderCodeCell(cell) {
    const source = getSource(cell); const lines = source.split('\n').map(line => highlightCode(line)).join('\n');
    const execCount = cell.execution_count || ' '; let outputHtml = '';
    if (cell.outputs && cell.outputs.length > 0) {
        const outputs = cell.outputs.map(renderOutput).join('');
        outputHtml = `<div class="cell-output"><div class="cell-prompt out">[${execCount}]:</div><div class="cell-output-content">${outputs}</div></div>`;
    }
    return `<div class="cell code-cell"><div class="cell-input"><div class="cell-prompt">[${execCount}]:</div><div class="cell-code"><pre>${lines}</pre></div></div>${outputHtml}</div>`;
}
function renderMarkdownCell(cell) { const source = getSource(cell); return `<div class="cell markdown-cell"><p>${renderMarkdown(source)}</p></div>`; }
function renderNotebook(notebook) { return notebook.cells.map(cell => { if (cell.cell_type === 'code') return renderCodeCell(cell); if (cell.cell_type === 'markdown') return renderMarkdownCell(cell); return ''; }).join(''); }
function loadNotebook() {
    fetch(NOTEBOOK_FILE).then(res => { if (!res.ok) throw new Error(`Impossible de charger ${NOTEBOOK_FILE}`); return res.json(); })
        .then(notebook => { document.getElementById('notebook-content').innerHTML = renderNotebook(notebook); })
        .catch(err => { document.getElementById('notebook-content').innerHTML = `<div style="text-align: center; padding: 2rem; color: #d9534f;">Erreur: ${escapeHtml(err.message)}</div>`; });
}
const notebook = document.getElementById('notebook');
const expandBtn = document.getElementById('expand-btn');
const expandIcon = document.getElementById('expand-icon');
const expandText = document.getElementById('expand-text');
function toggleFullscreen(e) {
  if (e) e.stopPropagation();
  
  const isFs = notebook.classList.contains('fullscreen');

  if (isFs) {
      // CAS : ON FERME (COLLAPSE)
      // 1. On coupe les animations pour √©viter l'effet bizarre de r√©tr√©cissement
      notebook.classList.add('resetting');
      
      // 2. On retire le plein √©cran
      notebook.classList.remove('fullscreen');
      
      // 3. On change l'ic√¥ne et le texte
      expandIcon.innerHTML = '<path d="M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z"/>';
      expandText.textContent = SharedUI.currentLang === "fr" ? 'Agrandir' : 'Expand';
      document.body.style.overflow = '';

      // 4. Apr√®s un tout petit d√©lai (50ms), on r√©active les animations 
      // pour que le survol (hover) refonctionne normalement
      setTimeout(() => {
          notebook.classList.remove('resetting');
      }, 50);

  } else {
      // CAS : ON OUVRE (EXPAND)
      notebook.classList.add('fullscreen');
      expandIcon.innerHTML = '<path d="M5 16h3v3h2v-5H5v2zm3-8H5v2h5V5H8v3zm6 11h2v-3h3v-2h-5v5zm2-11V5h-2v5h5V8h-3z"/>';
      expandText.textContent = SharedUI.currentLang === "fr" ? 'R√©duire' : 'Collapse';
      document.body.style.overflow = 'hidden';
  }
}
document.addEventListener('DOMContentLoaded', () => { SharedUI.init().then(() => { loadNotebook(); initIndexPage(); }); });
expandBtn.addEventListener('click', toggleFullscreen);
document.getElementById('notebook-header').addEventListener('click', (e) => { if (e.target !== expandBtn && !expandBtn.contains(e.target)) toggleFullscreen(e); });
document.addEventListener('keydown', (e) => { if (e.key === 'Escape' && notebook.classList.contains('fullscreen')) toggleFullscreen(); });
</script>
</body>
</html>